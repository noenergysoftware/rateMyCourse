<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" name="viewport">
    <meta name="theme-color" content="#4285f4">
    <title>登录</title>
    <!-- css -->
    <link href="./css/base.min.css" rel="stylesheet">
    <link href="./css/project.min.css" rel="stylesheet">
    <link href="./css/auth.css" rel="stylesheet">
    <link href="https://fonts.loli.net/css?family=Roboto:300,300italic,400,400italic,500,500italic|Material+Icons"
        rel="stylesheet">

    <!-- favicon -->

    <!-- ... -->
</head>
<style>
    .divcss5 {
        position: fixed;
        bottom: 0;
    }
</style>

<body class="page-brand">


    <div class="authpage">
        <div class="container">
            <form action="javascript:void(0);" method="POST">
                <div class="auth-main auth-row auth-col-one">
                    <div class="auth-top auth-row">
                        <!--点击返回首页的链接-->
                        <a class="boardtop-left" href="https://ratemycourse.tk/index.html">
                            <div>首 页</div>
                        </a>
                        <!--添加中间图片-->
                        <div class="auth-logo">
                            <img src="/resource/authlogo.jpg" alt="">
                        </div>
                        <!--点击跳转至注册链接-->
                        <a href="https://ratemycourse.tk/signup.html" class="boardtop-right">
                            <div>注 册</div>
                        </a>
                    </div>
                    <div class="auth-row">
                        <div class="form-group-label auth-row row-login">
                            <label class="" for="name">邮箱/用户名</label>
                            <input class="form-control maxwidth-auth" id="name" type="text" name="inputEmail">
                        </div>
                    </div>
                    <div class="auth-row">
                        <div class="form-group-label auth-row row-login">
                            <label  for="password">密码</label>             <!--class="floating-label"-->
                            <input class="form-control maxwidth-auth" id="password" type="password" name="Password">
                        </div>
                    </div>

                    <div class="btn-auth auth-row">
                        <button id="login" type="button" class="btn btn-block btn-brand waves-attach waves-light">
                            确认登录
                        </button>
                    </div>

                    <div class="auth-bottom auth-row">
                        <div class="tgauth">
                            <button class="btn" style="cursor:unset;"></button>
                        </div>
                    </div>
                </div>


        </div>
    </div>


    <!-- js -->
    <script src="./js/jquery.js"></script>
    <script src="./js/jquery.cookie.js"></script>
    <script src="./js/base.min.js"></script>
    <script src="./js/project.min.js"></script>
    <script src="./js/md5.min.js"></script>
    <script color="255,0,255" opacity="0.7" count="88" src="./js/canvas-nest.js"></script>
</body>

</html>
</div>

<script>
    let calltgbtn = document.querySelector('#calltgauth');
    let tgboard = document.querySelector('.card.auth-tg.cust-model');
    if (calltgbtn && tgboard)
        custModal(calltgbtn, tgboard);
</script>

<script>
    $(document).ready(function () {


        function login() {

            var name;
            var email;
            if ($("#name").val().indexOf("@") == -1) {       //true:是name登录
                name = document.getElementById("name").value;
                
            } else {
                
                email = document.getElementById("name").value;
            }
            

            //document.getElementByIssd("login").disabled = true;

            $.ajax({
                type: "POST",
                url: "https://api.ratemycourse.tk/signIn/",
                dataType: "json",
                data: {
                    username: name,
                    mail: email,
                    password: md5($("#password").val())
                },
                xhrFields: {
                    withCredentials: true
                },
                success: function (data) {
                    console.log(JSON.stringify(data));
                    console.log(data.status);
                    if (data.status == "1") {
                        $.cookie("username", data.body.username, { path: '/' });
                        //window.sessionStorage.setItem("status",data.status);           //登录成功"status"="0",用于切换导航栏
                        //window.sessionStorage.setItem("username",data.body.username);
                        //console.log("status"+window.sessionStorage.getItem("status"));
                        alert(data.body.username + "登录成功！");
                        window.setTimeout("location.href='./index.html'", 1200);
                    }
                    else {
                        alert(data.errMsg);
                    }
                    //window.setTimeout("location.href='/user'", 1200);

                },
                error: function (data) {
                    alert(JSON.stringify(data));
                }
            });
        }

        $("html").keydown(function (event) {
            //13 = enter
            if (event.keyCode == 13) {
                login();
            }
        });
        $("#login").click(function () {
            login();
        });

    })
</script>

<!--Username 非空验证-->

</script>